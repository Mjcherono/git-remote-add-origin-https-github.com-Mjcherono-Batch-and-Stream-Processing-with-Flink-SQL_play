# Apache Flink 

This repository is the **Apache Flink** by Confluent Developer.

## What this does

The code in this repo uses Docker Compose to start up a small Flink cluster and Flink's SQL Client.

## How to get it running

First build the image and start all of the containers:

```bash
docker compose up --build -d
```

Once the containers are running,

```bash
docker compose run sql-client
```

will drop you into the Flink SQL Client, where you can interact with Flink SQL.


### To Experiment with Batch and Streaming
We're going to create a fixed-length (bounded) table with 500 rows of data generated by the faker table source. flink-faker is a convenient and powerful mock data generator designed to be used with Flink SQL.

CREATE TABLE `bounded_pageviews` (
  `url` STRING,
  `user_id` STRING,
  `browser` STRING,
  `ts` TIMESTAMP(3)
)
WITH (
  'connector' = 'faker',
  'number-of-rows' = '500',
  'rows-per-second' = '100',
  'fields.url.expression' = '/#{GreekPhilosopher.name}.html',
  'fields.user_id.expression' = '#{numerify ''user_##''}',
  'fields.browser.expression' = '#{Options.option ''chrome'', ''firefox'', ''safari'')}',
  'fields.ts.expression' =  '#{date.past ''5'',''1'',''SECONDS''}'
);


##### To view
select * from bounded_pageviews limit 10;

#### Batch mode, bounded input
By default, the Flink SQL Client is running in streaming mode. Switch to batch mode so we can see how that behaves:

set 'execution.runtime-mode' = 'batch';

select count(*) AS `count` from bounded_pageviews;


####Â Streaming mode, bounded input
Trying the same thing, but in streaming mode.

set 'execution.runtime-mode' = 'streaming';

''' You should the count increment from 100 to 200, etc, up to 500. Again, this will take 5 seconds. ''' 


###### Change how the results are displayed
set 'sql-client.execution.result-mode' = 'changelog';

select count(*) AS `count` from bounded_pageviews;


#### Streaming mode, unbounded input
 If the faker source isn't configured with a number-of-rows setting then it will just continue producing data indefinitely

CREATE TABLE `pageviews` (
  `url` STRING,
  `user_id` STRING,
  `browser` STRING,
  `ts` TIMESTAMP(3)
)
WITH (
  'connector' = 'faker',
  'rows-per-second' = '100',
  'fields.url.expression' = '/#{GreekPhilosopher.name}.html',
  'fields.user_id.expression' = '#{numerify ''user_##''}',
  'fields.browser.expression' = '#{Options.option ''chrome'', ''firefox'', ''safari'')}',
  'fields.ts.expression' =  '#{date.past ''5'',''1'',''SECONDS''}'
);

###### Check new table
select count(*) AS `count` from pageviews;


To run faster, or slower, you can modify the table:
ALTER TABLE `pageviews` SET ('rows-per-second' = '10');

#### To exit flink
quit;



